const attackBoxEl=document['querySelector']('#room-attackbox'),attackBoxControlOpsEl=document['querySelector']('#attackbox-machine-options'),roomDetailsEl=document['querySelector']('#room-details'),roomContentEl=document['querySelector']('#room-content'),roomGridContentEl=document['querySelector']('#room-content-main'),roomGridAttackboxEl=document['querySelector']('#room-content-attackbox'),attackBoxLoadingEl=document['querySelector']('#room-attackbox-loading'),attackBoxVMViewEl=document['querySelector']('#room-attackbox-vm-view'),attackBoxInstanceEl=document['querySelector']('#attackbox-machine-instance'),attackBoxURLBtn=document['querySelector']('#room-attackbox-url'),attackBoxExpireTxt=document['querySelector']('#room-attackbox-expire-text'),attackBoxStartBtn=document['querySelector']('#browser-machine-start'),attackBoxOptions=document['querySelector']('#browser-machine-options'),attackBoxSplitScreenBtn=document['querySelector']('#browser-machine-split-view'),attackBoxTabs=document['querySelector']('#room-attackbox-tabs'),machinePrivIpEl=document['querySelector']('#browser-machine-privip'),machinePubIpEl=document['querySelector']('#browser-machine-pubip'),machineUsername=document['querySelector']('#browser-username'),machinePassword=document['querySelector']('#browser-password'),machineProtocol=document['querySelector']('#browser-protocol'),freeAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'freeattackbox','text':'Free\x20TryHackMe\x20AttackBox'},subAttackBoxInfo={'uploadId':'5f39eb6342e1ab8a6d900ba3','roomCode':'kali','text':'TryHackMe\x20AttackBox'},subKaliInfo={'uploadId':'5f3a9d6842e1ab8a6de7f291','roomCode':'kali','text':'Kali\x20Linux'};let myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo};subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo);let abConfig={'deploying':![],'deployed':![]},attackBoxExpireTimer,attackBoxInitCounter,webBasedInstances={},webBasedTab={'attackbox':![],'instanceId':null};function changeMyMachine(_0x2c0adc){attackBoxStartBtn['disabled']=![];if(_0x2c0adc=='kali-linux')myMachineSelected={'title':'Kali\x20Linux','id':'kali-linux','machineInfo':subKaliInfo};else _0x2c0adc=='attackbox'&&(myMachineSelected={'title':'AttackBox','id':'attackbox','machineInfo':freeAttackBoxInfo},subscribed=='1'&&(myMachineSelected['machineInfo']=subAttackBoxInfo));_0x2c0adc!='loading'?attackBoxStartBtn['innerHTML']='<i\x20class=\x22far\x20fa-laptop\x22></i>\x20Start\x20'+myMachineSelected['title']:(attackBoxStartBtn['disabled']=!![],attackBoxStartBtn['innerHTML']='<div\x20class=\x27d-flex\x20align-items-center\x27>\x0a\x20\x20\x20\x20\x20\x20<span\x20class=\x22spinner-border\x20spinner-border-sm\x20mr-2\x22\x20role=\x22status\x22\x20aria-hidden=\x22true\x22></span>\x20Starting...\x0a\x20\x20\x20\x20</div>');}function addWebBasedMachine(_0x5c8ea1){const _0x3747e8=_0x5c8ea1['instanceId'];webBasedInstances[_0x3747e8]=_0x5c8ea1,renderAttackBoxTabHTML();}function renderAttackBoxTabHTML(){attackBoxTabs['innerHTML']='';for(const [_0x3e51a1,_0xb8007e]of Object['entries'](webBasedInstances)){const _0x6795c2=Object['keys'](webBasedInstances)['length']==0x1?'tab-active':'';attackBoxTabs['innerHTML']+='<div\x20class=\x22'+_0x6795c2+'\x22\x20data-id=\x22'+_0x3e51a1+'\x22\x20onclick=\x22switchWebBasedTab(\x27'+_0x3e51a1+'\x27)\x22>'+_0xb8007e['title']+'<div>';}}function switchWebBasedTab(_0x927e12){attackBoxVMViewEl['style']['height']='',clearInterval(attackBoxExpireTimer),clearInterval(attackBoxInitCounter),switchWebBasedMachine(_0x927e12);}function initWebBasedMachine(_0xf71b61){setAttackBoxDetails('online');if(_0xf71b61['type']!='static-site'){attackBoxControlOpsEl['className']='',attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']='',renderAttackBox(_0xf71b61['title'],_0xf71b61['internalIP'],_0xf71b61['remote']['privateIp'],_0xf71b61['timeInSeconds'],_0xf71b61['created'],_0xf71b61['remote'],_0xf71b61['username'],_0xf71b61['password'],_0xf71b61['waitTime']);_0xf71b61['roomId']==myMachineSelected['machineInfo']['roomCode']?webBasedTab['attackbox']=!![]:webBasedTab['attackbox']=![];webBasedTab['instanceId']=_0xf71b61['instanceId'];const _0x4187cf=webBasedTab['attackbox']?'attackbox':'webbased';setNavConnStatus({'type':_0x4187cf,'virtualIP':_0xf71b61['remote']['privateIp']});}else renderiFrameHTML(_0xf71b61['url']),attackBoxControlOpsEl['className']='rem-attackbox-machine-options',setNavConnStatus({'type':'hide'});const _0x365db0=document['querySelectorAll']('#room-attackbox-tabs\x20>\x20div');for(let _0x2ca707 of _0x365db0){_0x2ca707['className']='';if(_0x2ca707['dataset']['id']==_0xf71b61['instanceId'])_0x2ca707['className']='tab-active';}}function switchWebBasedMachine(_0x2b22bd){const _0x3b82f2=webBasedInstances[_0x2b22bd];if(_0x3b82f2!=undefined)initWebBasedMachine(_0x3b82f2);}function startAttackBox(_0x10764c){if(!abConfig['deploying']){abConfig['deploying']=!![],changeMyMachine('loading'),$['post']('/account/dashboard/deploy-kali');if(_0x10764c['startingMsg'])displayMessages('','warning','Starting\x20your\x20machine..\x20please\x20wait!');$['post']('/material/deploy',{'id':myMachineSelected['machineInfo']['uploadId'],'roomCode':myMachineSelected['machineInfo']['roomCode']},async function(_0x2edab6){changeMyMachine(myMachineSelected['id']),_0x2edab6['success']?(addWebBasedMachine(_0x2edab6),initWebBasedMachine(_0x2edab6),attackboxEvent('room_page',myMachineSelected['machineInfo']['text']),displayMessages('Hooray!','success',_0x2edab6['msg']),showSplitScreenBtn('none'),showAttackStartBoxBtn('none'),abConfig['deployed']=!![],_0x10764c['tutorial']&&setTimeout(startIntroAttackBoxDeploy,0x1f4)):(displayMessages('Uh-oh!','danger',_0x2edab6['msg']),showAttackStartBoxBtn('show')),abConfig['deploying']=![];});}else displayMessages('','warning','Please\x20wait,\x20your\x20machine\x20is\x20still\x20loading..');}async function extendHourWebBasedVM(_0x4e6e0a){let _0x16c2f2;if(webBasedTab['attackbox']&&_0x4e6e0a==null)_0x16c2f2=extendAttackBox();else{_0x16c2f2=await addRoomVMHour();if(_0x16c2f2!=null)extendWebBasedTimer(_0x16c2f2);}const _0x1bb9da=_0x4e6e0a!=null?_0x4e6e0a:webBasedTab['instanceId'];if(_0x16c2f2!=null){let _0x5ce353=webBasedInstances[_0x1bb9da];_0x5ce353['timeInSeconds']=_0x16c2f2;}}function terminateWebBasedVM(_0x30c07a){webBasedTab['attackbox']&&_0x30c07a==null?terminateAttackBox():terminateRoomVM(),remWebBasedTabData(_0x30c07a);}function remWebBasedTabData(_0x2e160c){const _0x1a7845=_0x2e160c!=null?_0x2e160c:webBasedTab['instanceId'];delete webBasedInstances[_0x1a7845],Object['keys'](webBasedInstances)['length']==0x0?(setAttackBoxDetails('offline'),getNavConnOpenVPN()):setTimeout(function(){const _0x49ac0e=Object['keys'](webBasedInstances)[0x0];switchWebBasedTab(_0x49ac0e),renderAttackBoxTabHTML();},0x64);}function terminateAttackBox(){displayMessages('','success','Your\x20machine\x20has\x20been\x20terminated.'),$['post']('/api/vm/terminate',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0xe32ec2){clearInterval(attackBoxExpireTimer),_0xe32ec2['success']?(showAttackStartBoxBtn('show'),abConfig['deployed']=![]):displayMessages('Uh-oh!','warning',_0xe32ec2['msg']);});}function extendAttackBox(){return new Promise((_0xc64276,_0x517708)=>{$['post']('/api/vm/renew',{'code':myMachineSelected['machineInfo']['roomCode']},async function(_0x59e4b4){return _0x59e4b4['success']?(displayMessages('','success','Successfully\x20updated\x20your\x20machines\x20expiry\x20time.'),extendWebBasedTimer(_0x59e4b4['timeInSeconds']),_0xc64276(_0x59e4b4['timeInSeconds'])):(displayMessages('Uh-oh!','warning',_0x59e4b4['msg']),_0xc64276());});});}function extendWebBasedTimer(_0x55111f){clearInterval(attackBoxExpireTimer),attackBoxExpireTimer=startAttackBoxTimer(_0x55111f,attackBoxExpireTxt,'my-machine',attackBoxExpireTimer);}async function getModalAttackBoxPubIP(){const _0xb1aa23=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0xb1aa23['success']?machinePubIpEl['textContent']=_0xb1aa23['data']['internalIP']:machinePubIpEl['textContent']='-';}async function getAttackBoxStatus(){const _0x2d7361=await getRunningInstances(myMachineSelected['machineInfo']['roomCode']);_0x2d7361['success']?(showAttackStartBoxBtn('none'),addWebBasedMachine(_0x2d7361['data']),userObj['splitScreen']==!![]?(initWebBasedMachine(_0x2d7361['data']),showSplitScreenBtn('none')):showSplitScreenBtn('show'),setNavConnStatus({'type':'attackbox','virtualIP':_0x2d7361['data']['remote']['privateIp']}),abConfig['deployed']=!![]):(showAttackStartBoxBtn('show'),await getNavConnOpenVPN());}function showAttackStartBoxBtn(_0x42f9c4){_0x42f9c4=='show'&&!roomSettings['remAttackBoxBtn']?attackBoxOptions['style']['display']='inline-flex':attackBoxOptions['style']['display']='none';}function showSplitScreenBtn(_0x2a2f7e){_0x2a2f7e=='show'?attackBoxSplitScreenBtn['style']['display']='inline-flex':attackBoxSplitScreenBtn['style']['display']='none';}attackBoxSplitScreenBtn['onclick']=function(){showSplitScreenView();},attackBoxStartBtn['onclick']=function(){setSplitScreenSetting(!![]),startAttackBox({'startingMsg':!![],'tutorial':![]});};function setSplitScreenSetting(_0x15deb7){setUserSetting('room','splitScreen',_0x15deb7),userObj['splitScreen']=_0x15deb7;}function exitViewAttackBox(){setSplitScreenSetting(![]),setAttackBoxDetails('offline'),showSplitScreenBtn('show');}function showSplitScreenView(){setSplitScreenSetting(!![]),setAttackBoxDetails('online'),showSplitScreenBtn('none'),switchWebBasedTab(Object['keys'](webBasedInstances)[0x0]);}function infoAttackBox(){$('#attackBoxInfoModal')['modal']('toggle');}function setAttackBoxDetails(_0x343ca0){_0x343ca0=='online'?(roomContentEl['className']='room-flex',roomGridContentEl['className']='room-splitscreen-content',roomGridAttackboxEl['className']='room-attackbox',attackBoxLoadingEl['style']['display']='block',attackBoxEl['style']['display']='grid',roomLite('lite')):(attackBoxEl['style']['display']='none',roomContentEl['className']='',roomGridContentEl['className']='',roomGridContentEl['style']='',roomGridAttackboxEl['className']='',attackBoxVMViewEl&&(attackBoxVMViewEl['innerHTML']='',attackBoxVMViewEl['style']['height']=''),roomLite('regular'));}function renderAttackBox(_0x2cd0a3,_0x5c6c8a,_0x3444e0,_0x50aa8c,_0x2abc93,_0x5bb874,_0x4eb6e9,_0x345b26,_0x211344){extendWebBasedTimer(_0x50aa8c),checkAttackBoxDeploy(_0x2cd0a3,_0x5c6c8a,_0x50aa8c,_0x2abc93,_0x5bb874),machinePubIpEl['textContent']=_0x5c6c8a!=null?_0x5c6c8a:'-',machinePrivIpEl['textContent']=_0x3444e0,machineUsername['textContent']=_0x4eb6e9?_0x4eb6e9:'N/a',machinePassword['textContent']=_0x345b26?_0x345b26:'N/a',machineProtocol['textContent']=_0x5bb874['protocol'];}async function checkAttackBoxDeploy(_0x897aab,_0x38e9f3,_0x1d2fb7,_0x5988a6,_0x2715d3){if(_0x2715d3['active']){let _0x135a83=0x1;_0x2715d3['bootTime']&&(_0x135a83=_0x2715d3['bootTime']);const _0x2b2e18=_0x2715d3['remoteUrl'];attackBoxURLBtn['href']=_0x2b2e18,attackBoxTimer(_0x5988a6,_0x135a83,'deploy-browser',_0x2b2e18,_0x38e9f3),attackBoxLoadingEl['innerHTML']='<div\x20id=\x22machine-loading-attackbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-info\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22loading-msg\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x27>Your\x20machine\x20is\x20initializing...</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x27mb-0\x20faded\x27>Use\x20the\x20AttackBox\x20to\x20attack\x20machines\x20you\x20start\x20on\x20tasks</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22machine-loading-attackbox-progress\x22\x20class=\x22progress-bar\x20bg-success\x22\x20style=\x22width:0%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>';}}function renderiFrameHTML(_0x2388a7){attackBoxVMViewEl['innerHTML']='<iframe\x20style=\x22position:\x20static;\x22\x20id=\x22remote-connection-2\x22\x20onmouseover=\x22setRemote2ConnectionFocus()\x22\x20src=\x22'+_0x2388a7+'\x22\x20width=\x22100%\x22\x20height=\x22100%\x22\x20frameBorder=\x220\x22\x20allow=\x22fullscreen\x22>Browser\x20not\x20compatible.</iframe>',attackBoxVMViewEl['style']['height']='100%',attackBoxLoadingEl['style']['display']='none';}let webBasedLoadingSecs;async function attackBoxTimer(_0x50009b,_0xc2b30a,_0x4b1d6f,_0x277a85,_0x3d9e00){var _0x55afba=new Date(_0x50009b);_0x55afba['setMinutes'](_0x55afba['getMinutes']()+_0xc2b30a);attackBoxInitCounter&&clearInterval(attackBoxInitCounter);const _0x580a60=await getServerTime();webBasedLoadingSecs=((_0x55afba['getTime']()-_0x580a60['getTime']())/0x3e8)['toFixed'](0x0),attackBoxLoadingScreen(_0xc2b30a,_0x3d9e00,_0x277a85),webBasedLoadingSecs>0x0&&(attackBoxInitCounter=setInterval(async function(){attackBoxLoadingScreen(_0xc2b30a,_0x3d9e00,_0x277a85);},0x3e8));}function attackBoxLoadingScreen(_0x59860e,_0x2be0d7,_0x5d9074){webBasedLoadingSecs--;if(webBasedLoadingSecs<0x0){clearInterval(attackBoxInitCounter);const _0x10534b=document['querySelector']('#machine-loading-attackbox');if(_0x10534b)_0x10534b['outerHTML']='';attackBoxURLBtn['className']='clear-link',attackBoxURLBtn['innerHTML']='<div><i\x20class=\x22far\x20fa-expand-alt\x22></i></div>',machinePubIpEl['innerHTML']=_0x2be0d7!=null?_0x2be0d7:'<div\x20onclick=\x27getModalAttackBoxPubIP()\x27>Reveal\x20IP</div>',renderiFrameHTML(_0x5d9074);}else{attackBoxURLBtn['className']='clear-link\x20disabled',attackBoxURLBtn['innerHTML']='<div\x20class=\x27faded\x27>Access\x20desktop\x20in\x20'+webBasedLoadingSecs+'s</div>';const _0x254525=document['querySelector']('#machine-loading-attackbox-progress'),_0x3e7437=((0x1-(webBasedLoadingSecs/(_0x59860e*0x3c))['toFixed'](0x2))*0x64)['toFixed'](0x0);_0x254525&&(_0x254525['style']['width']=_0x3e7437+'%',_0x254525['textContent']=_0x3e7437+'%');}}function setRemote2ConnectionFocus(){document['querySelector']('#remote-connection-2')['contentWindow']['focus']();}function startAttackBoxTimer(_0x39c919,_0x539c60,_0x551a32,_0x51d1a9){let _0x463791=parseInt(_0x39c919),_0x210831=_0x463791,_0x26e561,_0x13067d,_0x20ce0b;return _0x51d1a9=setInterval(function(){_0x26e561=parseInt(_0x210831/0x3c,0xa)%0x3c,_0x13067d=parseInt(_0x210831%0x3c,0xa),_0x20ce0b=parseInt(_0x210831/0xe10,0xa),_0x26e561=_0x26e561<0xa?'0'+_0x26e561:_0x26e561,_0x13067d=_0x13067d<0xa?'0'+_0x13067d:_0x13067d,_0x20ce0b=_0x20ce0b<0xa?'0'+_0x20ce0b:_0x20ce0b;let _0x59d5f5=parseInt(_0x20ce0b)['toFixed'](0x0)+'h\x20'+_0x26e561+'m\x20'+_0x13067d+'s';_0x20ce0b==0x0&&(_0x59d5f5=_0x26e561+'m\x20'+_0x13067d+'s'),_0x539c60['textContent']=_0x59d5f5,--_0x210831<0x0&&(_0x210831=_0x463791);},0x3e8),_0x51d1a9;}function roomLite(_0x16079c){const _0x5de35c=document['querySelector']('.navbar-main'),_0x986ba7='navbar-lite';if(_0x16079c=='lite'){if(_0x5de35c&&!_0x5de35c['className']['includes'](_0x986ba7))_0x5de35c['classList']['toggle'](_0x986ba7);roomDetailsEl['className']='shorten-room-details';}else{if(_0x5de35c&&_0x5de35c['className']['includes'](_0x986ba7))_0x5de35c['classList']['toggle'](_0x986ba7);roomDetailsEl['className']='';}}